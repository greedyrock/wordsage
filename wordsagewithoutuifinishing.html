<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordSage</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1; /* Indigo 500 */
            --primary-light: #818cf8; /* Indigo 400 */
            --primary-dark: #4f46e5; /* Indigo 600 */
            --secondary: #f8fafc; /* Slate 50 */
            --text: #0f172a; /* Slate 900 */
            --text-light: #475569; /* Slate 600 */
            --success: #22c55e; /* Green 500 */
            --danger: #ef4444; /* Red 500 */
            --border: #e2e8f0; /* Slate 200 */
            --shadow: rgba(15, 23, 42, 0.08); /* Slate 900 with opacity */
            --shadow-md: rgba(15, 23, 42, 0.15); /* Slightly stronger shadow */
            --background-light: #ffffff; /* White */
            --gradient: linear-gradient(135deg, #6366f1, #4f46e5); /* Indigo gradient */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background-color: var(--secondary);
            color: var(--text);
            line-height: 1.6;
            overflow: hidden; /* Prevent body scroll */
        }

        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient); /* Use the gradient background */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Ensure it's on top */
            color: white;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            animation: fadeOut 1s ease-out 2s forwards; /* Fade out after 2s delay */
        }

        .splash-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0; /* Start invisible for animation */
            transform: scale(0.8); /* Start slightly smaller */
            animation: scaleUpFadeIn 1s ease-out 0.5s forwards; /* Scale up and fade in */
        }

        .splash-logo svg {
            width: 3rem;
            height: 3rem;
            margin-bottom: 1rem;
            /* Optional: Add a subtle rotation animation to the SVG */
            animation: rotate 2s linear infinite;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                visibility: hidden; /* Hide completely */
            }
        }

        @keyframes scaleUpFadeIn {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

         @keyframes rotate {
             from {
                 transform: rotate(0deg);
             }
             to {
                 transform: rotate(360deg);
             }
         }


        /* Layout */
        .container {
            display: flex;
            min-height: 100vh;
            width: 100%;
            overflow: hidden; /* Keep content contained */
        }

        /* Sidebar */
        .sidebar {
            width: 280px; /* Increased width slightly */
            background: var(--background-light); /* Solid background for contrast */
            color: var(--text);
            padding: 1.5rem; /* Consistent padding */
            box-shadow: 2px 0 6px var(--shadow); /* Shadow on the right */
            display: flex;
            flex-direction: column;
            flex-shrink: 0; /* Prevent shrinking */
             overflow-y: auto; /* Allow sidebar content to scroll if needed */
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem; /* Increased gap */
            margin-bottom: 2.5rem; /* More space below logo */
            color: var(--primary);
            font-weight: 700;
            font-size: 1.6rem; /* Slightly larger font */
        }

        .logo svg {
            width: 2rem; /* Larger logo */
            height: 2rem;
             color: var(--primary-dark); /* Use dark primary for icon */
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.9rem 1rem; /* More padding */
            border-radius: 0.6rem; /* More rounded */
            text-decoration: none;
            color: var(--text-light); /* Lighter color for non-active */
            margin-bottom: 0.6rem; /* More space between items */
            font-weight: 500;
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.1s ease;
        }

        .nav-item svg {
             width: 1.35rem; /* Slightly larger icons */
             height: 1.35rem;
             color: var(--border); /* Default icon color */
        }

        .nav-item:hover {
            background-color: var(--secondary); /* Light background on hover */
            color: var(--text); /* Darker text on hover */
             transform: translateX(3px); /* Subtle slide effect */
        }
         .nav-item:hover svg {
             color: var(--primary-light); /* Primary color on icon hover */
         }


        .nav-item.active {
            background: var(--gradient); /* Gradient background for active */
            color: white; /* White text for active */
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.3); /* Shadow for active */
        }

        .nav-item.active svg {
             color: white; /* White icon for active */
        }

        /* Note List */
        .note-list-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 1rem;
            padding-top: 1rem; /* Add padding above list title */
            border-top: 1px solid var(--border); /* Separator line */
        }

        .note-list {
            margin-top: 1.5rem; /* Adjusted margin-top */
            flex: 1;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        /* Custom Scrollbar */
        .note-list::-webkit-scrollbar,
        .note-textarea::-webkit-scrollbar,
        .groq-response::-webkit-scrollbar {
            width: 8px;
        }

        .note-list::-webkit-scrollbar-track,
        .note-textarea::-webkit-scrollbar-track,
        .groq-response::-webkit-scrollbar-track {
            background: var(--secondary); /* Match body/panel background */
        }

        .note-list::-webkit-scrollbar-thumb,
        .note-textarea::-webkit-scrollbar-thumb,
        .groq-response::-webkit-scrollbar-thumb {
            background-color: var(--border);
            border-radius: 4px;
        }

        .note-list::-webkit-scrollbar-thumb:hover,
        .note-textarea::-webkit-scrollbar-thumb:hover,
        .groq-response::-webkit-scrollbar-thumb:hover {
            background-color: var(--text-light);
        }

        .note-item {
            padding: 0.9rem; /* Increased padding */
            border-radius: 0.6rem; /* More rounded */
            margin-bottom: 0.6rem; /* Space between items */
            cursor: pointer;
            border: 1px solid var(--border); /* Subtle border */
            background-color: var(--background-light);
            box-shadow: 0 1px 4px var(--shadow); /* Subtle shadow */
            transition: all 0.2s ease;
        }

        .note-item:last-child {
            margin-bottom: 0;
        }

        .note-item:hover {
             transform: translateY(-3px); /* Subtle lift effect */
             box-shadow: 0 3px 10px var(--shadow-md); /* Stronger shadow on hover */
             border-color: var(--primary-light); /* Highlight border on hover */
        }

        .note-item.active {
            border-color: var(--primary);
            background-color: rgba(99, 102, 241, 0.1); /* Light primary background */
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.2); /* Active shadow */
             transform: none; /* Remove lift effect when active */
        }

        .note-title {
            font-weight: 600;
            font-size: 0.95rem; /* Slightly larger title */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--text);
        }

        .note-preview {
            font-size: 0.8rem; /* Slightly larger preview */
            color: var(--text-light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-top: 0.4rem; /* More space below title */
        }

        /* Main Content Area */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            overflow: hidden; /* Prevent main content overflow */
        }

        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.8rem; /* More space below top bar */
            gap: 1.5rem; /* Increased gap */
        }

        .search-bar {
            position: relative;
            flex: 1;
            max-width: 500px;
            min-width: 150px;
        }

        .search-bar input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.8rem; /* More padding, space for icon */
            border-radius: 0.6rem;
            border: 1px solid var(--border);
            outline: none;
            transition: all 0.2s ease;
            background-color: var(--background-light);
            color: var(--text);
            font-size: 1rem;
        }

        .search-bar input::placeholder {
            color: var(--text-light);
        }

        .search-bar input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            background-color: var(--background-light);
        }

        .search-bar svg {
            position: absolute;
            left: 1rem; /* Position icon */
            top: 50%;
            transform: translateY(-50%);
            width: 1.3rem; /* Slightly larger icon */
            height: 1.3rem;
            color: var(--text-light);
        }

        .buttons {
            display: flex;
            gap: 0.9rem; /* Increased gap */
            flex-shrink: 0;
        }

        .btn {
            padding: 0.8rem 1.4rem; /* More padding */
            border-radius: 0.6rem; /* More rounded */
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.6rem; /* Increased gap */
            font-size: 1rem;
        }

        .btn svg {
            width: 1.35rem; /* Slightly larger icons */
            height: 1.35rem;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light)); /* Hover gradient */
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4); /* Stronger shadow on hover */
            transform: translateY(-2px); /* Subtle lift effect */
        }

         .btn-outline {
             background-color: transparent;
             border: 1px solid var(--border);
             color: var(--text);
         }

         .btn-outline:hover {
             background-color: var(--secondary);
             border-color: var(--text-light);
             color: var(--text); /* Ensure text stays readable */
             transform: translateY(-2px); /* Subtle lift */
         }
         .btn-outline svg {
             color: var(--text-light); /* Default icon color */
         }
          .btn-outline:hover svg {
             color: var(--text); /* Darker icon on hover */
          }

        .btn:disabled {
            opacity: 0.6; /* Reduced opacity for disabled */
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }


        /* Note Editor */
        .note-editor {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-radius: 0.75rem;
            box-shadow: 0 6px 16px var(--shadow-md); /* Stronger shadow for editor */
            background-color: var(--background-light);
            overflow: hidden;
        }

        .editor-header {
            padding: 1rem 1.5rem; /* More horizontal padding */
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }

        .editor-actions {
            display: flex;
            gap: 0.6rem; /* Increased gap */
            flex-shrink: 0;
        }

        .editor-btn {
            padding: 0.6rem; /* Increased padding */
            border-radius: 0.5rem; /* More rounded */
            background-color: transparent;
            border: none;
            cursor: pointer;
            color: var(--text-light);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .editor-btn svg {
            width: 1.4rem; /* Larger icons */
            height: 1.4rem;
        }

        .editor-btn:hover:not(:disabled) {
            background-color: var(--secondary);
            color: var(--primary); /* Primary color highlight on hover */
        }
        .editor-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .editor-title {
            flex: 1;
            margin-left: 0.5rem;
            padding: 0.6rem; /* Match editor-btn padding */
            border: none;
            font-size: 1.25rem; /* Larger title font */
            font-weight: 700; /* Bolder title */
            outline: none;
            background-color: transparent;
            color: var(--text);
            min-width: 100px; /* Prevent title from collapsing completely */
        }

        .editor-title::placeholder {
            color: var(--text-light);
             font-weight: 500;
        }

        .editor-content {
            flex: 1;
            padding: 1.5rem; /* Consistent padding */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .note-textarea {
            flex: 1;
            border: none;
            resize: none;
            font-size: 1rem;
            line-height: 1.7;
            outline: none;
            padding: 0; /* Remove padding here, handled by editor-content */
            background-color: transparent;
            color: var(--text);
            overflow-y: auto;
        }

        .note-textarea::placeholder {
            color: var(--text-light);
        }

        /* Groq Panel */
        .groq-panel {
            padding: 1.5rem; /* Consistent padding */
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background-color: var(--secondary); /* Subtle background */
        }

        .groq-title {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-weight: 600;
            color: var(--text);
            font-size: 1.05rem; /* Slightly larger title */
        }

        .groq-title svg {
            width: 1.3rem; /* Consistent icon size */
            height: 1.3rem;
            color: var(--primary);
        }

        .groq-actions {
            display: flex;
            gap: 0.9rem; /* Match button gap */
        }

        .groq-input {
            flex: 1;
            position: relative;
        }

        .groq-input input {
            width: 100%;
            padding: 0.8rem 1rem; /* Match button padding height */
            border-radius: 0.6rem;
            border: 1px solid var(--border);
            outline: none;
            transition: all 0.2s ease;
            background-color: var(--background-light);
            color: var(--text);
            font-size: 1rem;
        }

        .groq-input input::placeholder {
            color: var(--text-light);
        }

        .groq-input input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            background-color: var(--background-light);
        }

        .groq-response {
            padding: 1rem;
            border-radius: 0.5rem;
            background-color: var(--background-light);
            font-size: 0.9rem; /* Slightly larger response text */
            line-height: 1.6; /* Better readability */
            white-space: pre-wrap;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid var(--border);
            color: var(--text-light); /* Default response color */
        }

        .groq-response.loading {
            font-style: italic;
            color: var(--text-light);
        }

        .groq-response.error {
            color: var(--danger);
            font-weight: 500;
        }

        .groq-response:not(.loading):not(.error):not(:empty):not(:contains("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")) {
             color: var(--text); /* Darker text for actual responses */
        }


        /* API Key Modal Styles */
        .api-key-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6); /* Darker overlay */
            z-index: 100;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px); /* Add blur effect */
        }

        .modal-content {
            background-color: var(--background-light);
            border-radius: 0.75rem;
            width: 95%; /* Slightly wider on small screens */
            max-width: 550px; /* Increased max-width */
            padding: 2rem; /* Increased padding */
            box-shadow: 0 10px 25px var(--shadow-md); /* Stronger shadow */
            animation: fadeInScale 0.3s ease-out;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95); /* Start slightly smaller */
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.8rem; /* Increased margin */
            padding-bottom: 1.2rem; /* Increased padding */
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.5rem; /* Larger title */
            font-weight: 700;
            color: var(--text);
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 2rem; /* Larger close button */
            color: var(--text-light);
            transition: color 0.2s ease;
            line-height: 1; /* Prevent extra space */
        }

        .modal-close:hover {
            color: var(--text);
        }

        .modal-body {
            margin-bottom: 2rem; /* Increased margin */
        }

        .form-group {
            margin-bottom: 1.2rem; /* Increased margin */
        }

        .form-label {
            display: block;
            margin-bottom: 0.6rem; /* Increased margin */
            font-weight: 600; /* Bolder label */
            color: var(--text);
            font-size: 0.95rem; /* Slightly larger label */
        }

        .form-input {
            width: 100%;
            padding: 0.8rem 1rem; /* Match button padding height */
            border-radius: 0.6rem;
            border: 1px solid var(--border);
            outline: none;
            transition: all 0.2s ease;
            background-color: var(--secondary); /* Light background for inputs */
            color: var(--text);
            font-size: 1rem;
        }

        .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            background-color: var(--background-light); /* White on focus */
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.9rem; /* Match button gap */
            padding-top: 1.5rem; /* Increased padding */
            border-top: 1px solid var(--border);
        }

        .modal-footer .btn {
            min-width: 100px; /* Give buttons a minimum width */
            justify-content: center; /* Center text in buttons */
        }


        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem; /* More space from bottom */
            right: 2rem; /* More space from right */
            padding: 1.1rem 1.5rem; /* Increased padding */
            border-radius: 0.6rem; /* More rounded */
            background-color: var(--success);
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); /* Slightly stronger shadow */
            display: flex;
            align-items: center;
            gap: 0.6rem; /* Increased gap */
            transform: translateY(30px); /* Start further below */
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease-out; /* Smoother transition */
            z-index: 101;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .toast svg {
            width: 1.4rem; /* Larger icon */
            height: 1.4rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--border);
                padding: 1rem;
                flex-direction: row; /* Arrange logo/nav items horizontally */
                justify-content: space-between;
                align-items: center;
                flex-wrap: wrap;
                box-shadow: 0 2px 6px var(--shadow); /* Shadow on the bottom */
                 overflow-y: visible; /* No scroll needed here */
            }

             .logo {
                 margin-bottom: 0;
                 flex-shrink: 0;
                 font-size: 1.4rem;
             }

             .logo svg {
                 width: 1.8rem;
                 height: 1.8rem;
             }

            /* Hide the note list on small screens */
            .note-list-title,
            .note-list {
                display: none;
            }

            /* Allow horizontal scrolling for nav items if they overflow */
             .sidebar > a.nav-item {
                 flex-shrink: 0; /* Prevent nav items from shrinking */
                 width: auto; /* Allow items to take natural width */
             }
            .sidebar {
                overflow-x: auto; /* Enable horizontal scroll */
                -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
                scrollbar-width: none;  /* Hide scrollbar for Firefox */
                 /* Hide scrollbar for Chrome, Safari and Opera */
                 &::-webkit-scrollbar {
                     display: none;
                 }
             }


            .main {
                padding: 1rem;
            }

            .top-bar {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
                margin-bottom: 1.5rem;
            }

            .search-bar {
                max-width: 100%;
            }

            .buttons {
                justify-content: space-between;
                width: 100%;
                gap: 0.8rem;
            }

            .btn {
                flex: 1;
                justify-content: center;
                padding: 0.7rem 1rem; /* Adjusted padding */
                font-size: 0.9rem; /* Slightly smaller font */
            }
             .btn svg {
                 width: 1.2rem;
                 height: 1.2rem;
             }


            .note-editor {
                min-height: 60vh;
            }

             .editor-header {
                 padding: 0.8rem 1rem; /* Reduced padding */
             }

             .editor-actions {
                 gap: 0.4rem; /* Reduced gap */
             }

             .editor-btn {
                 padding: 0.4rem; /* Reduced padding */
             }
             .editor-btn svg {
                 width: 1.3rem; /* Keep icons reasonable size */
                 height: 1.3rem;
             }

             .editor-title {
                 font-size: 1.1rem;
                 margin-left: 0; /* Remove margin */
                 padding: 0.4rem;
             }

             .editor-content {
                 padding: 1rem; /* Reduced padding */
             }

             .note-textarea {
                 font-size: 0.95rem;
             }

            .groq-panel {
                padding: 1rem; /* Reduced padding */
                gap: 0.8rem;
            }

             .groq-title {
                 font-size: 1rem;
             }

             .groq-title svg {
                 width: 1.2rem;
                 height: 1.2rem;
             }

             .groq-actions {
                 flex-direction: column; /* Stack input and button */
                 gap: 0.8rem;
             }

             .groq-input input {
                 padding: 0.7rem 1rem; /* Match new button padding */
                 font-size: 0.95rem;
             }

             .groq-response {
                max-height: 120px; /* Smaller AI response area */
                 font-size: 0.85rem;
                 padding: 0.8rem;
            }

            .api-key-modal {
                padding: 1rem; /* Add padding around modal */
            }

            .modal-content {
                padding: 1.5rem; /* Reduced modal padding */
            }

            .modal-header {
                margin-bottom: 1.2rem;
                padding-bottom: 0.8rem;
            }

            .modal-title {
                font-size: 1.3rem;
            }

            .modal-body {
                 margin-bottom: 1.5rem;
            }

            .form-group {
                margin-bottom: 1rem;
            }

             .form-label {
                 font-size: 0.9rem;
             }

             .form-input {
                 padding: 0.7rem 1rem;
                 font-size: 0.95rem;
             }

            .modal-footer {
                padding-top: 1.2rem;
                gap: 0.8rem;
            }
             .modal-footer .btn {
                 min-width: auto; /* Remove min-width */
             }

             .toast {
                 bottom: 1rem;
                 right: 1rem;
                 padding: 0.9rem 1.2rem;
                 gap: 0.5rem;
             }
             .toast svg {
                 width: 1.2rem;
                 height: 1.2rem;
             }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen">
        <div class="splash-logo">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <span>WordSage</span>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                <span>WordSage</span>
            </div>

            <!-- Navigation Items -->
            <!-- Kept for structure, updated styling -->
            <a href="#" class="nav-item active">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>Home</span>
            </a>

            <a href="#" class="nav-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                <span>All Notes</span>
            </a>

            <a href="#" class="nav-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>
                <span>Favorites</span>
            </a>

            <a href="#" class="nav-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polygon points="10 8 16 12 10 16 10 8"></polygon>
                </svg>
                <span>AI Assistant</span>
            </a>

            <a href="#" class="nav-item" id="apiKeyButton">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
                </svg>
                <span>API Settings</span>
            </a>

             <div class="note-list-title">My Notes</div>
            <!-- Note List will be dynamically populated -->
            <div class="note-list" id="noteList">
                <!-- Note items will be added here by JavaScript -->
            </div>
        </div>

        <div class="main">
            <div class="top-bar">
                <div class="search-bar">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" id="searchNotes" placeholder="Search notes...">
                </div>

                <div class="buttons">
                     <!-- Added Delete Button -->
                     <button class="btn btn-outline" id="deleteNoteBtn" disabled>
                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                             <polyline points="3 6 5 6 21 6"></polyline>
                             <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                             <line x1="10" y1="11" x2="10" y2="17"></line>
                             <line x1="14" y1="11" x2="14" y2="17"></line>
                         </svg>
                         <span>Delete</span>
                     </button>

                    <button class="btn btn-outline" id="saveNoteBtn" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        <span>Save</span>
                    </button>

                    <button class="btn btn-primary" id="newNoteBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        <span>New Note</span>
                    </button>
                </div>
            </div>

            <div class="note-editor">
                <div class="editor-header">
                    <div class="editor-actions">
                         <!-- Placeholder buttons - no functionality added -->
                        <button class="editor-btn" title="Edit Mode" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>

                        <button class="editor-btn" title="Read Aloud" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                            </svg>
                        </button>

                         <!-- Added Favorite Button -->
                        <button class="editor-btn" id="favoriteNoteBtn" title="Favorite Note" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                        </button>
                    </div>

                    <input type="text" class="editor-title" id="editorTitle" placeholder="Note title...">
                </div>

                <div class="editor-content">
                    <textarea class="note-textarea" id="noteTextarea" placeholder="Start typing here..."></textarea>
                </div>

                <div class="groq-panel">
                    <div class="groq-title">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <span>Groq AI Assistant</span>
                    </div>

                    <div class="groq-actions">
                        <div class="groq-input">
                            <input type="text" id="groqPrompt" placeholder="Ask Groq something about your notes..." disabled>
                        </div>

                        <button class="btn btn-primary" id="askGroqBtn" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                            <span>Ask</span>
                        </button>
                    </div>

                    <div class="groq-response" id="groqResponse">
                        Response will appear here. Set up your Groq API key in the API settings to get started.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="api-key-modal" id="apiKeyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Groq API Settings</h3>
                <button class="modal-close" id="closeModal">×</button>
            </div>

            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="apiKey">Groq API Key</label>
                    <input type="password" id="apiKey" class="form-input" placeholder="Enter your Groq API key...">
                </div>

                <div class="form-group">
                    <label class="form-label" for="modelSelect">Model</label>
                    <select id="modelSelect" class="form-input">
                        <option value="llama3-8b-8192">Llama 3 8B (Fast)</option>
                        <option value="llama3-70b-8192">Llama 3 70B (Larger)</option>
                        <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                        <option value="gemma-7b-it">Gemma 7B</option>
                    </select>
                </div>
                 <p style="font-size: 0.85rem; color: var(--text-light);">Get your API key from <a href="https://console.groq.com/keys" target="_blank" style="color: var(--primary); text-decoration: none; font-weight: 500;">Groq Console</a>.</p>
            </div>

            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelBtn">Cancel</button>
                <button class="btn btn-primary" id="saveApiKeyBtn">Save Settings</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        <span>Settings saved successfully!</span>
    </div>

    <script>
        // --- DOM Elements ---
        const splashScreen = document.querySelector('.splash-screen');
        const apiKeyButton = document.getElementById('apiKeyButton');
        const apiKeyModal = document.getElementById('apiKeyModal');
        const closeModal = document.getElementById('closeModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveApiKeyBtn = document.getElementById('saveApiKeyBtn');
        const apiKeyInput = document.getElementById('apiKey');
        const modelSelect = document.getElementById('modelSelect');
        const toast = document.getElementById('toast');
        const askGroqBtn = document.getElementById('askGroqBtn');
        const groqPromptInput = document.getElementById('groqPrompt');
        const groqResponseDiv = document.getElementById('groqResponse');
        const saveNoteBtn = document.getElementById('saveNoteBtn');
        const newNoteBtn = document.getElementById('newNoteBtn');
        const deleteNoteBtn = document.getElementById('deleteNoteBtn');
        const editorTitleInput = document.getElementById('editorTitle');
        const noteTextarea = document.getElementById('noteTextarea');
        const noteListDiv = document.getElementById('noteList');
        const favoriteNoteBtn = document.getElementById('favoriteNoteBtn');
        const searchNotesInput = document.getElementById('searchNotes');

        // --- State ---
        // WARNING: HARDCODING API KEYS IN CLIENT-SIDE JS IS NOT SECURE.
        // For a real application, use a backend to handle API calls.
        // This is included *only* to make the demo functional out-of-the-box.
        // Replace with your actual key or remove the hardcoded part entirely.
        // It's better to start with null/empty and force user to enter.
        // const HARDCODED_API_KEY_FOR_DEMO = "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"; // Replace or remove this line
        let apiKey = localStorage.getItem('groqApiKey'); // Start without hardcoded key
        let model = localStorage.getItem('groqModel') || 'llama3-8b-8192'; // Default to 8B
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let currentNoteId = null; // null indicates a new note

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            // Apply theme preference if any (not implemented, but good practice)
            // set initial UI state based on local storage
            updateGroqPanelState(); // Set initial state of AI panel

            // If no notes exist, create a default one
            if (notes.length === 0) {
                 createNewNote(); // Creates a new blank note and sets currentNoteId = null
                 // No need to auto-save a truly blank note initially
            } else {
                 renderNotes(); // Render the list first
                 loadNote(notes[0].id); // Load the first note by default
            }

            // Listen for input changes in editor to enable/disable save/delete
             editorTitleInput.addEventListener('input', enableEditorButtons);
             noteTextarea.addEventListener('input', enableEditorButtons);

            // Search functionality (basic filtering)
             searchNotesInput.addEventListener('input', filterNotes);

             // Handle splash screen visibility after load
             // The CSS animation handles fadeOut and visibility
             // No JS needed here unless you want to remove the element entirely after animation
        });

        // Optional: Remove splash screen element after animation finishes for cleaner DOM
        splashScreen.addEventListener('animationend', (event) => {
            if (event.animationName === 'fadeOut') {
                splashScreen.remove();
            }
        });


        // --- Functions ---

        function renderNotes(filter = '') {
            noteListDiv.innerHTML = ''; // Clear current list
            const lowerCaseFilter = filter.toLowerCase();

            const filteredNotes = notes.filter(note =>
                note.title.toLowerCase().includes(lowerCaseFilter) ||
                note.content.toLowerCase().includes(lowerCaseFilter)
            );

            // Sort by update date, newest first
            filteredNotes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));

            if (filteredNotes.length === 0 && filter) {
                 noteListDiv.innerHTML = '<div style="padding: 0.9rem; color: var(--text-light); text-align: center; font-size: 0.875rem;">No notes found matching your search.</div>';
                 return;
            } else if (notes.length === 0) { // Use original notes array length to check if *any* notes exist
                 noteListDiv.innerHTML = '<div style="padding: 0.9rem; color: var(--text-light); text-align: center; font-size: 0.875rem;">No notes yet. Click "New Note" to create one.</div>';
                 // If there are no notes at all, ensure editor is blank and currentNoteId is null
                 // This case is handled by the initial load, but good defensive check
                 if (currentNoteId !== null) createNewNote();
                 return;
            } else if (filteredNotes.length === 0) {
                 noteListDiv.innerHTML = '<div style="padding: 0.9rem; color: var(--text-light); text-align: center; font-size: 0.875rem;">No notes found matching your search.</div>';
                 return;
            }


            filteredNotes.forEach(note => {
                const noteItem = document.createElement('div');
                noteItem.classList.add('note-item');
                if (note.id === currentNoteId) {
                    noteItem.classList.add('active');
                }
                noteItem.dataset.noteId = note.id; // Store ID on the element

                const noteTitle = document.createElement('div');
                noteTitle.classList.add('note-title');
                noteTitle.textContent = note.title || 'Untitled Note'; // Default title

                const notePreview = document.createElement('div');
                notePreview.classList.add('note-preview');
                // Get the first non-empty line or snippet
                const firstLine = note.content.split('\n').find(line => line.trim().length > 0);
                const previewText = (firstLine || '').substring(0, 100) || 'No content';
                notePreview.textContent = previewText + (note.content.length > 100 ? '...' : '');


                noteItem.appendChild(noteTitle);
                noteItem.appendChild(notePreview);

                // Add click listener using the loadNote function
                noteItem.addEventListener('click', () => loadNote(note.id));

                noteListDiv.appendChild(noteItem);
            });
        }

        function loadNote(id) {
            // Save current note before loading a new one if editor has content and it's an existing note
             if (currentNoteId !== null && (editorTitleInput.value.trim() !== '' || noteTextarea.value.trim() !== '')) {
                  saveNote(); // Autosave the previously open note
             } else if (currentNoteId === null && (editorTitleInput.value.trim() !== '' || noteTextarea.value.trim() !== '')) {
                 // Also autosave a new note if typing has started before switching
                 saveNote();
             }


            const note = notes.find(n => n.id === id);
            if (note) {
                currentNoteId = note.id;
                editorTitleInput.value = note.title;
                noteTextarea.value = note.content;
                // Update the active class in the list
                renderNotes(searchNotesInput.value); // Re-render to highlight active
                enableEditorButtons(); // Enable save and delete buttons
                // Reset AI panel state when loading a new note
                groqPromptInput.value = '';
                updateGroqPanelState();

            } else {
                // If note not found (e.g., deleted in another window/tab), load a new note state
                console.warn(`Note with ID ${id} not found. Creating new note.`);
                createNewNote(); // This handles resetting the editor state and currentNoteId
            }
        }

        function saveNote() {
            const title = editorTitleInput.value.trim() || 'Untitled Note';
            const content = noteTextarea.value.trim();

             // Check if the note is substantially empty (no content and default title)
             const isSubstantiallyEmpty = content === '' && title === 'Untitled Note';

             if (currentNoteId === null) {
                 // Logic for creating a new note
                 if (isSubstantiallyEmpty) {
                     // Don't save a new, completely empty note
                     showToast('Cannot save empty note.', false);
                     disableEditorButtons(); // Re-disable if note becomes empty
                     return;
                 }
                 const now = new Date().toISOString();
                 const newNote = {
                     id: Date.now(), // Simple unique ID based on timestamp
                     title: title,
                     content: content,
                     createdAt: now,
                     updatedAt: now,
                     favorite: false // Add favorite status
                 };
                 notes.push(newNote);
                 currentNoteId = newNote.id; // Select the newly created note
                 showToast('Note created!', true);

             } else {
                 // Logic for updating an existing note
                 const noteIndex = notes.findIndex(n => n.id === currentNoteId);
                 if (noteIndex !== -1) {
                     // If content is empty but title is custom, keep the note
                     if (content === '' && title !== 'Untitled Note') {
                         notes[noteIndex].title = title;
                         notes[noteIndex].content = ''; // Keep content empty
                         notes[noteIndex].updatedAt = new Date().toISOString();
                         showToast('Note updated!', true);
                     } else if (isSubstantiallyEmpty) {
                          // If it was an existing note and is now empty, delete it
                          deleteNote(true); // Pass true to skip confirmation
                          showToast('Empty note deleted.', true); // Indicate it was deleted
                          return; // Stop the save process here
                     }
                     else {
                         // Otherwise, save title and content
                         notes[noteIndex].title = title;
                         notes[noteIndex].content = content;
                         notes[noteIndex].updatedAt = new Date().toISOString();
                         showToast('Note updated!', true);
                     }
                 } else {
                      // Should not happen if currentNoteId is managed correctly, but handle defensively
                     console.error(`Attempted to save note with ID ${currentNoteId} but it wasn't found.`);
                     showToast('Error saving note.', false);
                     return;
                 }
             }

            // Save to localStorage and re-render list
            localStorage.setItem('notes', JSON.stringify(notes));
            renderNotes(searchNotesInput.value); // Render with potential filter
            enableEditorButtons(); // Ensure buttons are enabled after saving (unless it was deleted)
        }


         function createNewNote() {
             // Autosave the currently open note if it has content before creating a new one
             if (currentNoteId !== null && (editorTitleInput.value.trim() !== '' || noteTextarea.value.trim() !== '')) {
                 saveNote();
             } else if (currentNoteId === null && (editorTitleInput.value.trim() !== '' || noteTextarea.value.trim() !== '')) {
                  // Also autosave if it was a new note being edited
                  saveNote();
             }

             currentNoteId = null; // Indicate it's a new note
             editorTitleInput.value = '';
             noteTextarea.value = '';
             groqPromptInput.value = '';
             updateGroqPanelState(); // Reset AI panel state
             renderNotes(searchNotesInput.value); // Remove active highlight
             disableEditorButtons(); // Disable save/delete until typing starts
             editorTitleInput.focus(); // Put cursor in the title field
             // Optional: Show a toast indicating a new note was created state
             // showToast('New note ready.', true); // Might be too chatty
         }

         function deleteNote(skipConfirmation = false) {
             if (!currentNoteId) {
                 showToast('No note selected to delete.', false);
                 return;
             }

             if (!skipConfirmation && !confirm('Are you sure you want to delete this note?')) {
                 return;
             }

             notes = notes.filter(note => note.id !== currentNoteId);
             localStorage.setItem('notes', JSON.stringify(notes));

             if (!skipConfirmation) showToast('Note deleted!', true);


             // Load the first note if available, otherwise create a new blank one
             if (notes.length > 0) {
                 loadNote(notes[0].id);
             } else {
                 createNewNote();
                 // Don't auto-save the completely blank state after deleting the last note
             }
         }

        function askGroq() {
            const prompt = groqPromptInput.value.trim();
            const noteContent = noteTextarea.value.trim();

            if (!apiKey) {
                groqResponseDiv.textContent = 'Please set your Groq API key in the API settings.';
                groqResponseDiv.className = 'groq-response error';
                showToast('API Key not set.', false);
                return;
            }

             if (!prompt) {
                 groqResponseDiv.textContent = 'Please enter a prompt for the AI.';
                 groqResponseDiv.className = 'groq-response'; // Reset classes
                 return;
             }

            groqResponseDiv.textContent = 'Thinking...';
            groqResponseDiv.className = 'groq-response loading'; // Set loading class

            // Prepare messages for the API
            const messages = [];
            // Add a system message to set the AI's persona and context
            messages.push({ role: 'system', content: "You are a helpful AI assistant named Groq, designed to assist with note-taking by summarizing, explaining, expanding, or answering questions based on the provided note content and user queries. Be concise and directly address the user's prompt based on the given text." });

            if (noteContent) {
                 messages.push({ role: 'user', content: `Regarding the following note:\n\n---\n${noteContent}\n---\n\n${prompt}` });
            } else {
                 messages.push({ role: 'user', content: prompt });
            }

            fetch('https://api.groq.com/openai/v1/chat/completions', { // Correct Groq API endpoint
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: model,
                    messages: messages,
                    temperature: 0.7, // Add temperature for control
                    max_tokens: 800 // Increased max tokens
                })
            })
            .then(response => {
                 if (!response.ok) {
                     // Attempt to read error message from body
                     return response.json().then(err => {
                          const errorMessage = err.error?.message || JSON.stringify(err) || `HTTP error! status: ${response.status}`;
                          throw new Error(errorMessage);
                     }).catch(() => {
                          // Fallback if response body can't be parsed as JSON
                          throw new Error(`HTTP error! status: ${response.status}`);
                     });
                 }
                 return response.json();
            })
            .then(data => {
                 const assistantResponse = data.choices?.[0]?.message?.content?.trim(); // Trim whitespace
                if (assistantResponse) {
                    groqResponseDiv.textContent = assistantResponse;
                    groqResponseDiv.className = 'groq-response'; // Reset classes
                } else {
                     groqResponseDiv.textContent = 'No content received in the AI response.';
                     groqResponseDiv.className = 'groq-response error';
                }
            })
            .catch(error => {
                console.error('Groq API Error:', error);
                groqResponseDiv.textContent = `Error: ${error.message || 'Failed to fetch from Groq API.'}`;
                groqResponseDiv.className = 'groq-response error';
                if (error.message.includes('API key') || error.message.includes('authentication')) {
                     showToast('Invalid or missing API Key. Check settings.', false);
                } else if (error.message.includes('rate limit')) {
                     showToast('Rate limit exceeded. Try again later.', false);
                }
            });
        }

        function showToast(message, isSuccess = true) {
            // Clear any existing timeout to prevent toasts from cancelling each other prematurely
             clearTimeout(toast.dataset.timeoutId);

            toast.querySelector('span').textContent = message;
             if (isSuccess) {
                toast.style.backgroundColor = 'var(--success)';
             } else {
                 toast.style.backgroundColor = 'var(--danger)';
             }

            toast.classList.add('show');
            const timeoutId = setTimeout(() => {
                toast.classList.remove('show');
            }, 3500); // Hide after 3.5 seconds
            toast.dataset.timeoutId = timeoutId; // Store timeout ID on the element
        }

        function enableSaveButton() {
             const title = editorTitleInput.value.trim();
             const content = noteTextarea.value.trim();
             // Enable if there's content OR a custom title (even if content is empty)
             // Check if currentNoteId exists OR if there's content/title in a *new* note
             saveNoteBtn.disabled = currentNoteId === null && (content === '' && title === '');
             // If an existing note becomes completely empty, the save button will stay enabled
             // but the save function will trigger a delete.
        }

         function enableDeleteButton() {
              // Enable delete only if an existing note is loaded (currentNoteId is not null)
             deleteNoteBtn.disabled = currentNoteId === null;
         }

         function enableEditorButtons() {
             // Enable save/delete/favorite buttons based on note state
             enableSaveButton(); // Save depends on content/title state
             enableDeleteButton(); // Delete depends on whether a note is loaded
             // Favorite button is only enabled for existing notes
             favoriteNoteBtn.disabled = currentNoteId === null;

              // Update favorite icon state (optional)
             const currentNote = notes.find(n => n.id === currentNoteId);
             if (favoriteNoteBtn && currentNote) {
                  // You could add a class or change the fill/stroke color based on note.favorite
                  // For simplicity, we just enable/disable the button itself here.
             }
         }

         function disableEditorButtons() {
             saveNoteBtn.disabled = true;
             deleteNoteBtn.disabled = true;
             favoriteNoteBtn.disabled = true;
         }

         function filterNotes() {
             const filterText = searchNotesInput.value;
             renderNotes(filterText);
         }

        function updateGroqPanelState() {
             if (apiKey) {
                 groqResponseDiv.textContent = groqResponseDiv.textContent.includes('API key') ? 'Groq API connected. Ask a question about your notes.' : groqResponseDiv.textContent; // Keep response if it's not the default "set key" message
                 groqResponseDiv.className = 'groq-response'; // Reset classes
                 askGroqBtn.disabled = false;
                 groqPromptInput.disabled = false;
             } else {
                 groqResponseDiv.textContent = 'Set up your Groq API key in the API settings to get started.';
                 groqResponseDiv.className = 'groq-response'; // Reset classes
                 askGroqBtn.disabled = true;
                 groqPromptInput.disabled = true;
             }
             // Ensure model select reflects current state
             modelSelect.value = model;
        }


        // --- Event Listeners ---
        apiKeyButton.addEventListener('click', () => {
            // Populate modal input with current key (if stored)
            apiKeyInput.value = localStorage.getItem('groqApiKey') || '';
            modelSelect.value = localStorage.getItem('groqModel') || 'llama3-8b-8192';
            apiKeyModal.style.display = 'flex';
        });

        closeModal.addEventListener('click', () => {
            apiKeyModal.style.display = 'none';
        });

        cancelBtn.addEventListener('click', () => {
            apiKeyModal.style.display = 'none';
        });

        saveApiKeyBtn.addEventListener('click', () => {
            const enteredApiKey = apiKeyInput.value.trim();
            const selectedModel = modelSelect.value;

            // Update state and local storage
            apiKey = enteredApiKey;
            model = selectedModel;
            localStorage.setItem('groqApiKey', apiKey);
            localStorage.setItem('groqModel', model);

            apiKeyModal.style.display = 'none';
            showToast('API settings saved!');

            // Update Groq panel status
            updateGroqPanelState();
        });

        askGroqBtn.addEventListener('click', askGroq);

        saveNoteBtn.addEventListener('click', saveNote);

        newNoteBtn.addEventListener('click', createNewNote);

         deleteNoteBtn.addEventListener('click', () => deleteNote()); // Wrap in arrow function to allow passing skipConfirmation

        // Favorite button (example functionality)
         favoriteNoteBtn.addEventListener('click', () => {
             if (!currentNoteId) return; // Should be disabled if no note
             const noteIndex = notes.findIndex(n => n.id === currentNoteId);
             if (noteIndex !== -1) {
                 notes[noteIndex].favorite = !notes[noteIndex].favorite;
                 localStorage.setItem('notes', JSON.stringify(notes));
                 showToast(notes[noteIndex].favorite ? 'Note favorited!' : 'Note unfavorited!');
                 // Optional: Update the favorite button's appearance here
             }
         });

        // Allow pressing Enter in Groq prompt to trigger search
         groqPromptInput.addEventListener('keypress', function(event) {
             if (event.key === 'Enter' && !askGroqBtn.disabled) {
                 event.preventDefault();
                 askGroqBtn.click();
             }
         });

        // Autosave when leaving the page (beforeunload)
        window.addEventListener('beforeunload', () => {
             // Only attempt to save if an existing note is loaded AND modified,
             // OR if a new note has *any* content/title.
             const isNewNote = currentNoteId === null;
             const title = editorTitleInput.value.trim();
             const content = noteTextarea.value.trim();

             if (isNewNote) {
                 if (content !== '' || title !== '') {
                     saveNote(); // Save the unsaved new note
                 }
             } else {
                 // Check if an existing note has been modified
                 const originalNote = notes.find(n => n.id === currentNoteId);
                 if (originalNote) {
                     if (originalNote.title !== title || originalNote.content !== content) {
                         saveNote(); // Save the modified existing note
                     }
                 }
             }
         });


    </script>
</body>
</html>
